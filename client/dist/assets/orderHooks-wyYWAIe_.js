import{a,i as m,u as y,k as i,n as s}from"./index-BqlAPq8n.js";const L=async e=>{const{data:r}=await a.get("/orders",{params:e});return r},Q=async e=>{const r=await a.get(`/orders/${e}`);return console.log(e,r.data),r.data},$=async e=>(console.log(e),(await a.post("/orders/cod",e)).data),P=async e=>{const r=await a.post("/orders/wallet",e);return console.log(r.data),r.data},h=async e=>(console.log(e),(await a.post("/orders/online",e)).data),k=async e=>(console.log("paymentDetails",e),(await a.post("/orders/verify-online-order",{paymentDetails:e})).data),M=async({orderId:e,reason:r})=>(console.log(e,r),(await a.post(`/orders/${e}/cancel`,{reason:r})).data),K=async({orderId:e,itemId:r,reason:n})=>(console.log(e,r),(await a.post(`/orders/${e}/items/${r}/cancel`,{reason:n})).data),U=async e=>(await a.get(`/orders/${e}/invoice`,{responseType:"blob"})).data,_=async({orderId:e,reason:r})=>{const{data:n}=await a.post(`/orders/${e}/return`,{reason:r});return n},j=async({orderId:e,itemId:r,reason:n})=>{const{data:o}=await a.post(`/orders/${e}/items/${r}/return`,{reason:n});return o},p={all:["orders"]},d="orderDetails",g=(e,r)=>{if(e!=="Delivered"||!r)return!1;const n=new Date(r),o=new Date,c=new Date(n);return c.setDate(c.getDate()+7),o<=c},T=e=>{const r=Object.fromEntries(e.entries());return y({queryKey:["myOrders",r],queryFn:()=>L(e),keepPreviousData:!0,staleTime:1e3*60*1})},x=()=>{const e=m();return i({mutationFn:$,onSuccess:()=>{e.invalidateQueries(p.all)},onError:r=>{s.error(r?.response?.data?.error?.message||"Something went wrong")}})},A=()=>{const e=m();return i({mutationFn:P,onSuccess:()=>{e.invalidateQueries(p.all)},onError:r=>{console.log("err",r),s.error(r?.response?.data?.error?.message||"Something went wrong")}})},W=()=>{const e=m();return i({mutationFn:h,onSuccess:()=>{e.invalidateQueries(p.all)},onError:r=>{s.error(r?.response?.data?.error?.message||"Something went wrong")}})},Y=()=>{const e=m();return i({mutationFn:k,onSuccess:()=>{e.invalidateQueries(p.all)},onError:r=>{s.error(r?.response?.data?.error?.message||"Something went wrong")}})},B=e=>{const r=m(),{data:n,isLoading:o,isError:c,error:w}=y({queryKey:[d,e],queryFn:()=>Q(e),enabled:!!e,onError:t=>{s.error(t?.response?.data?.error?.message||"Failed to fetch order details")}}),{mutate:O,isLoading:v}=i({mutationFn:M,onSuccess:()=>{s.success("Order cancelled successfully"),r.invalidateQueries([d,e])},onError:t=>s.error(t.response?.data?.message||"Failed to cancel order")}),{mutate:D,isLoading:E}=i({mutationFn:K,onSuccess:()=>{s.success("Item cancelled successfully"),r.invalidateQueries([d,e])},onError:t=>s.error(t.response?.data?.error?.message||"Failed to cancel item")}),{mutate:S,isLoading:R}=i({mutationFn:_,onSuccess:()=>{s.success("Return requested successfully"),r.invalidateQueries([d,e])},onError:t=>s.error(t.response?.data?.error?.message||"Failed to request return")}),{mutate:f,isLoading:F}=i({mutationFn:j,onSuccess:()=>{s.success("Item return requested successfully"),r.invalidateQueries([d,e])},onError:t=>s.error(t.response?.data?.error?.message||"Failed to request item return")}),u=n?.data,q=u&&["Pending","Processing"].includes(u.orderStatus),b=u&&g(u.orderStatus,u.timeline?.deliveredAt);return{order:u,isLoading:o,isError:c,error:w,actions:{cancelOrder:t=>O({orderId:e,reason:t}),cancelItem:(t,l)=>D({orderId:e,itemId:t,reason:l}),returnOrder:t=>S({orderId:e,reason:t}),returnItem:(t,l)=>f({orderId:e,itemId:t,reason:l})},state:{isCancelling:v,isItemCancelling:E,isReturning:R,isItemReturning:F,canCancelOrder:q,canReturnOrder:b},helpers:{getItemStatus:t=>{const l=["Pending","Processing"].includes(t.status),C=t.status==="Delivered"&&g("Delivered",u?.timeline?.deliveredAt);return{isCancellable:l,isReturnable:C}}}}},V=()=>i({mutationFn:async e=>{const r=await U(e._id),n=new Blob([r],{type:"application/pdf"}),o=window.URL.createObjectURL(n),c=document.createElement("a");return c.href=o,c.download=`invoice-${e.orderId}.pdf`,c.click(),window.URL.revokeObjectURL(o),!0}});export{A as a,W as b,Y as c,B as d,T as e,V as f,x as u};
