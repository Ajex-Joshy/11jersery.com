import{c as Q,j as e,P as i,o as Y,O as H,i as X,r as l,aY as Z,aZ as G,a_ as J,a$ as K,k as ee,z as k,a as re,a1 as se,W as te,g as ne,C as S}from"./index-B5Zfx6Dp.js";import{S as ae}from"./StatusBadge-ThsDvtkB.js";import{O as ie,F as de}from"./FeeWarningModal-CTWJ3BQ_.js";import{C as I}from"./circle-x-DcyuO4gP.js";import{C as oe}from"./circle-check-big-DH180LVK.js";import{P as le}from"./package-check-DtODxttE.js";import{A as ce}from"./arrow-left-Mx3ZEDUT.js";import"./truck-D2GmSzlw.js";const ue=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],me=Q("save",ue),P=({item:t,onCancelItem:y,onApproveReturn:j,onRejectReturn:c,onConfirmReturn:v})=>{const N=d=>d==="Delivered"?"text-green-600 bg-green-50 border-green-200":d==="Cancelled"||d==="Return Rejected"?"text-red-600 bg-red-50 border-red-200":d==="Return Requested"?"text-orange-600 bg-orange-50 border-orange-200":d==="Return Approved"?"text-blue-600 bg-blue-50 border-blue-200":d==="Returned"?"text-gray-600 bg-gray-100 border-gray-200":"text-gray-600 bg-gray-50 border-gray-200",u=["Cancelled","Returned","Return Rejected"].includes(t.status),x=["Pending","Processing"].includes(t.status);return e.jsxs("div",{className:"flex gap-4 p-4 border-b border-gray-100 last:border-0 items-start relative group",children:[e.jsx("div",{className:"w-16 h-16 flex-shrink-0 bg-gray-100 rounded-md overflow-hidden border border-gray-200",children:e.jsx("img",{src:t.imageUrl,alt:t.title,className:`w-full h-full object-cover ${u?"grayscale opacity-60":""}`,onError:d=>{d.target.src="/placeholder.jpg"}})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:`font-medium text-sm text-gray-900 line-clamp-1 ${u?"line-through text-gray-500":""}`,children:t.title}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Size: ",t.size," | Qty: ",t.quantity]})]}),e.jsxs("p",{className:"font-medium text-sm text-gray-900",children:["â‚¹",t.salePrice?.toLocaleString()]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded border ${N(t.status)}`,children:t.status}),t.cancelReason&&e.jsxs("span",{className:"text-[10px] text-gray-400 italic truncate max-w-[200px]",title:t.cancelReason,children:["Reason: ",t.cancelReason]}),t.returnReason&&e.jsxs("span",{className:"text-[10px] text-orange-600 italic truncate max-w-[200px]",title:t.returnReason,children:["Return Reason: ",t.returnReason]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[x&&e.jsxs("button",{onClick:()=>y(t._id),className:"flex items-center gap-1 text-[10px] font-medium text-red-600 bg-red-50 hover:bg-red-100 px-2 py-1 rounded border border-red-200 transition",children:[e.jsx(I,{size:12})," Cancel Item"]}),t.status==="Return Requested"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>j(t._id),className:"flex items-center gap-1 text-[10px] font-medium text-green-700 bg-green-50 hover:bg-green-100 px-2 py-1 rounded border border-green-200 transition",children:[e.jsx(oe,{size:12})," Approve Return"]}),e.jsxs("button",{onClick:()=>c(t._id),className:"flex items-center gap-1 text-[10px] font-medium text-red-700 bg-red-50 hover:bg-red-100 px-2 py-1 rounded border border-red-200 transition",children:[e.jsx(I,{size:12})," Reject"]})]}),t.status==="Return Approved"&&e.jsxs("button",{onClick:()=>v(t._id),className:"flex items-center gap-1 text-[10px] font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 px-2 py-1 rounded border border-blue-200 transition",children:[e.jsx(le,{size:12})," Confirm Received"]})]})]})]})};P.propTypes={item:i.shape({_id:i.string.isRequired,title:i.string.isRequired,size:i.string.isRequired,quantity:i.number.isRequired,salePrice:i.number.isRequired,status:i.string.isRequired,imageUrl:i.string.isRequired,cancelReason:i.string,returnReason:i.string}).isRequired,onCancelItem:i.func.isRequired,onApproveReturn:i.func.isRequired,onRejectReturn:i.func.isRequired,onConfirmReturn:i.func.isRequired};const ve=()=>{const{orderId:t}=Y(),y=H(),j=X(),[c,v]=l.useState(""),[N,u]=l.useState(!1),[x,d]=l.useState(""),[O,R]=l.useState({isOpen:!1,onProceed:null}),[o,b]=l.useState({isOpen:!1,type:null,itemId:null}),{order:r,isLoading:q,isError:M,error:L,actions:h,state:m}=Z(t),A=(s,a=null)=>{let g=r.price.discountedPrice;if(s==="item"&&a){const _=r.items.find(V=>V._id===a);_&&(g-=_.salePrice*_.quantity)}else s==="order"&&(g=0);if(g>0&&g<500){R({isOpen:!0,onProceed:()=>{R({isOpen:!1,onProceed:null}),b({isOpen:!0,type:s,itemId:a})}});return}b({isOpen:!0,type:s,itemId:a})},z=()=>{o.type==="order"?h.cancelOrder(r.userId,x):o.type==="item"&&h.cancelItem(r.userId,o.itemId,x),b({isOpen:!1,type:null,itemId:null}),d("")},E=G(),T=J(),F=K(),[n,C]=l.useState({isOpen:!1,type:null,itemId:null}),[f,w]=l.useState(""),p=(s,a=null)=>{C({isOpen:!0,type:s,itemId:a}),w("")},D=()=>{const{type:s,itemId:a}=n;if(r){switch(s){case"cancel_order":h.cancelOrder(r.userId,f);break;case"cancel_item":h.cancelItem(r.userId,a,f);break;case"approve_return":E.mutate({orderId:t,itemId:a});break;case"reject_return":T.mutate({orderId:t,itemId:a,reason:f});break;case"confirm_return":F.mutate({orderId:t,itemId:a});break;default:console.warn("Unknown action:",s);break}C({isOpen:!1,type:null,itemId:null}),w("")}},{mutate:B,isLoading:U}=ee({mutationFn:async({status:s})=>{await re.patch(`/admin/orders/${t}/status`,{status:s})},onSuccess:()=>{k.success("Order status updated"),j.invalidateQueries(["adminOrders",t]),u(!1)},onError:s=>k.error(s.response?.data?.error?.message||"Failed to update status")}),$=()=>{c&&c!==r.orderStatus?B({status:c}):u(!1)};if(q)return e.jsx(se,{text:"Loading order details..."});if(M)return e.jsx(te,{error:L});if(!r)return e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Order not found"});const W=["Pending","Processing","Shipped","Delivered"];return e.jsxs("div",{className:"p-6 bg-gray-50/50 min-h-screen font-sans",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>y(-1),className:"p-2 hover:bg-gray-200 rounded-full text-gray-600 transition-colors",children:e.jsx(ce,{size:20})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:["Order #",r.orderId||r._id?.slice(-6).toUpperCase(),e.jsx(ae,{status:r.orderStatus})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Placed on ",new Date(r.createdAt).toLocaleString("en-IN")]})]}),r.items.every(s=>s.status==="Return Requested")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p("approve_return",null),className:"px-4 py-2 bg-green-100 border border-green-300 text-green-700 text-sm font-medium rounded-md hover:bg-green-200 transition",children:"Approve Return"}),e.jsx("button",{onClick:()=>p("reject_return",null),className:"px-4 py-2 bg-red-100 border border-red-300 text-red-700 text-sm font-medium rounded-md hover:bg-red-200 transition",children:"Reject Return"})]}),r.items.every(s=>s.status==="Return Approved")&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>p("confirm_return",null),className:"px-4 py-2 bg-green-100 border border-green-300 text-green-700 text-sm font-medium rounded-md hover:bg-green-200 transition",children:"Confirm Received"})})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[N?e.jsxs("div",{className:"flex items-center gap-2 bg-white p-1 rounded-lg border border-gray-300 shadow-sm",children:[e.jsx("select",{value:c||r.orderStatus,onChange:s=>v(s.target.value),className:"text-sm border-none focus:ring-0 py-1 pl-2 pr-8 bg-transparent",children:W.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("button",{onClick:$,disabled:U,className:"p-1.5 bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors",children:e.jsx(me,{size:16})})]}):e.jsx("button",{onClick:()=>u(!0),disabled:["Cancelled","Delivered","Returned"].includes(r.orderStatus),className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Change Status"}),m.canCancelOrder&&e.jsx("button",{onClick:()=>A("order"),disabled:m.isCancelling,className:"px-4 py-2 bg-white border border-red-200 text-red-600 text-sm font-medium rounded-md hover:bg-red-50 transition",children:"Cancel Order"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:e.jsx(ie,{timeline:r.timeline,status:r.orderStatus})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50/50 flex justify-between items-center",children:e.jsxs("h2",{className:"font-semibold text-gray-900",children:["Items (",r.items.length,")"]})}),r.items.map(s=>e.jsx(P,{item:s,onCancelItem:a=>A("item",a),onApproveReturn:a=>p("approve_return",a),onRejectReturn:a=>p("reject_return",a),onConfirmReturn:(a,g)=>p("confirm_return",a)},s._id))]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:[e.jsx("h2",{className:"font-semibold text-gray-900 mb-4",children:"Customer"}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold",children:r.shippingAddress?.firstName?.[0]||"U"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[r.shippingAddress?.firstName," ",r.shippingAddress?.lastName]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",r.userId?.slice(-6)||"N/A"]})]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{children:"Email:"})," ",e.jsx("span",{className:"font-medium text-gray-900",children:r.shippingAddress?.email})]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{children:"Phone:"})," ",e.jsx("span",{className:"font-medium text-gray-900",children:r.shippingAddress?.phoneNumber})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:[e.jsx("h2",{className:"font-semibold text-gray-900 mb-4",children:"Shipping Address"}),e.jsxs("address",{className:"not-italic text-sm text-gray-600 leading-relaxed",children:[r.shippingAddress?.addressLine1,e.jsx("br",{}),r.shippingAddress?.addressLine2&&e.jsxs(e.Fragment,{children:[r.shippingAddress.addressLine2,e.jsx("br",{})]}),r.shippingAddress?.city,", ",r.shippingAddress?.state,e.jsx("br",{}),r.shippingAddress?.country," -"," ",r.shippingAddress?.pinCode]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:[e.jsx("h2",{className:"font-semibold text-gray-900 mb-4",children:"Payment Info"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Method"}),e.jsx("span",{className:"font-medium text-gray-900",children:r.payment?.method})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Status"}),e.jsx("span",{className:`font-medium px-2.5 py-0.5 rounded-full text-xs ${r.payment?.status==="Paid"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-800"}`,children:r.payment?.status})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-100 flex justify-between font-bold text-base text-gray-900",children:[e.jsx("span",{children:"Total Amount"}),e.jsx("span",{children:ne(r?.price?.total)})]})]})]})]})]}),e.jsx(de,{isOpen:O.isOpen,onClose:()=>R({isOpen:!1,onProceed:null}),onProceed:O.onProceed}),e.jsx(S,{isOpen:o.isOpen,onClose:()=>b({...o,isOpen:!1}),onConfirm:z,title:o.type==="order"?"Cancel Entire Order?":"Cancel Item?",message:o.type==="order"?"Are you sure you want to cancel this order? This action cannot be undone.":"Are you sure you want to cancel this specific item?",confirmButtonText:"Yes, Cancel",confirmButtonVariant:"danger",isLoading:m.isCancelling||m.isItemCancelling,children:e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason (Optional)"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-black focus:border-black",rows:3,placeholder:"Why are you cancelling?",value:x,onChange:s=>d(s.target.value)})]})}),e.jsx(S,{isOpen:n.isOpen,onClose:()=>C({...n,isOpen:!1}),onConfirm:D,title:n.type==="cancel_order"?"Cancel Entire Order?":n.type==="cancel_item"?"Cancel Item?":n.type==="approve_return"?"Approve Return?":n.type==="reject_return"?"Reject Return?":"Confirm Receipt & Refund?",message:n.type==="cancel_order"||n.type==="cancel_item"?"Are you sure you want to cancel this?":n.type==="approve_return"?"The user will be notified to ship the item back.":n.type==="reject_return"?"Please provide a reason for rejection.":"Confirming receipt will automatically restock the item and refund the user.",confirmButtonText:n.type==="cancel_order"||n.type==="cancel_item"?"Yes, Cancel":n.type==="approve_return"?"Approve":n.type==="reject_return"?"Reject Request":"Confirm & Refund",confirmButtonVariant:n.type==="cancel_order"||n.type==="cancel_item"||n.type==="reject_return"?"danger":"success",isLoading:m.isCancelling||m.isItemCancelling,children:(n.type==="cancel_order"||n.type==="cancel_item"||n.type==="reject_return")&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason (Optional)"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-black focus:border-black",rows:3,placeholder:"Provide reason...",value:f,onChange:s=>w(s.target.value)})]})})]})};export{ve as default};
