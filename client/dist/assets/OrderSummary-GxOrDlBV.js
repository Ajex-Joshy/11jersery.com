import{a as h,i as f,k as j,n as c,a7 as v,r as y,O as M,d as U,g as a,j as e,a1 as W,W as X,a8 as Y,l as _,X as G,L as b,P as H}from"./index-199rnzlN.js";import{A as J}from"./arrow-right-BrA6Hsf4.js";const V=async t=>{const{data:s}=await h.post("/coupons/coupon",{code:t});return s.data},Z=async()=>{const{data:t}=await h.delete("/coupons/coupon");return t.data},$=()=>{const t=f();return j({mutationFn:V,onSuccess:s=>{console.log("data",s),c.success("Coupon applied!"),t.invalidateQueries([v])},onError:s=>{console.log("err",s);const n=s?.response?.data?.error?.message||"Invalid Coupon";c.error(n)}})},ee=()=>{const t=f();return j({mutationFn:Z,onSuccess:()=>{c.success("Coupon removed"),t.invalidateQueries([v])}})},se=({isCheckoutPage:t})=>{const[s,n]=y.useState(""),{mutate:C,isLoading:i}=$(),{mutate:N,isLoading:l}=ee(),w=M(),[d,k]=y.useState(!1),D=()=>{k(!0),w("/checkout")},S=()=>{s.trim()&&(C(s),n(""))},{data:L,isLoading:P,isError:F,error:I}=U(),r=L?.data,{subtotal:R,total:A,deliveryFee:u,discount:p,specialDiscount:m,couponDiscount:x,referralBonus:g}=r||{},E=a(R),T=a(A),B=a(u),z=a(p),O=a(m),Q=a(x),q=a(g);if(P)return e.jsx(W,{text:"Loading checkout..."});if(F)return e.jsx(X,{error:I});const K=[{label:"Discount",value:p,formatted:z},{label:"Special Discount",value:m,formatted:O},{label:"Coupon Discount",value:x,formatted:Q},{label:"Referral Bonus",value:g,formatted:q}];return e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 sticky top-24",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 border-b pb-4",children:"Order Summary"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsx("span",{className:"font-medium text-gray-900",children:E})]}),K.map(o=>o.value>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600",children:o.label}),e.jsxs("span",{className:"font-medium text-green-600",children:["- ",o.formatted]})]},o.label)),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Delivery Fee"}),e.jsx("span",{className:"font-medium text-gray-900",children:u===0?"Free":B})]})]}),e.jsx("div",{className:"border-t border-gray-200 mt-4 pt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:T})]})}),!t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"py-4 border-y border-gray-200 my-4",children:r.couponCode?e.jsxs("div",{className:"flex justify-between items-center bg-green-50 p-2 rounded border border-green-200 text-sm",children:[e.jsxs("span",{className:"text-green-700 font-medium flex items-center gap-2",children:[e.jsx(Y,{size:14})," ",r.couponCode," applied"]}),e.jsx("button",{onClick:()=>N(),disabled:l,className:"text-gray-400 hover:text-red-500",children:l?e.jsx(_,{size:14,className:"animate-spin"}):e.jsx(G,{size:14})})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:o=>n(o.target.value.toUpperCase()),placeholder:"Enter Coupon Code",className:"flex-1 border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:border-black"}),e.jsx("button",{onClick:S,disabled:i||!s,className:"bg-black text-white px-4 py-2 rounded text-sm font-medium hover:bg-gray-800 disabled:opacity-50",children:i?"...":"Apply"})]})}),e.jsxs("button",{onClick:D,disabled:d,className:"w-full bg-black text-white py-3 rounded-lg font-semibold flex items-center justify-center gap-2 hover:bg-gray-800 transition mt-6",children:[d?"Processing...":"Checkout",e.jsx(J,{size:18})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-4 text-center",children:["By continuing, I confirm that I have read and accept the",e.jsxs(b,{to:"/terms-and-conditions",className:"underline hover:text-black",children:[" ","Terms and Conditions"," "]}),"and",e.jsxs(b,{to:"/privacy-policy",className:"underline hover:text-black",children:[" ","Privacy Policy"]}),"."]})]})]})};se.propTypes={isCheckoutPage:H.bool};export{se as O};
