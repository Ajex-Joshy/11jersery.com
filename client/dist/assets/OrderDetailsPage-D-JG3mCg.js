import{j as e,L as T,g as D,P as i,o as E,O as L,r as f,a1 as W,W as M,C as $,n as v}from"./index-B5Zfx6Dp.js";import{O as V,F as B}from"./FeeWarningModal-CTWJ3BQ_.js";import{I as F}from"./Buttons-euKaLE0f.js";import{d as U,c as H}from"./orderHooks-CUPYWUC0.js";import{A as Q,P as Y}from"./AddressCard-CryXhN5h.js";import{l as G}from"./loadRazorpay-CDvUoVkj.js";import{A as J}from"./arrow-left-Mx3ZEDUT.js";import"./circle-x-DcyuO4gP.js";import"./truck-D2GmSzlw.js";const C=({item:s,onCancelItem:h,onReturnItem:l,canReturn:x})=>{const p=["Cancelled","Returned","Return Requested","Return Rejected"].includes(s.status),u=["Pending","Processing"].includes(s.status);console.log(s.status,u);const d=a=>a==="Delivered"?"text-green-600":a==="Cancelled"||a==="Return Rejected"?"text-red-600":a==="Return Requested"?"text-orange-600":a==="Returned"||a==="Return Approved"?"text-blue-600":"text-gray-600";return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 p-4 border-b border-gray-100 last:border-0",children:[e.jsx("div",{className:"w-20 h-20 flex-shrink-0 bg-gray-100 rounded-md overflow-hidden border border-gray-200",children:e.jsx("img",{src:s.imageUrl,alt:s.title,className:`w-full h-full object-cover ${p?"grayscale opacity-70":""}`,onError:a=>{a.target.src="/placeholder.jpg"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(T,{to:`/product/${s.slug}`,className:`font-semibold text-gray-900 hover:underline line-clamp-1 ${p?"text-gray-500 line-through":""}`,children:s.title}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Size: ",s.size," | Qty: ",s.quantity]})]}),e.jsx("p",{className:"font-medium text-gray-900",children:D(s.salePrice)})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap justify-between items-center gap-2",children:[e.jsxs("div",{className:"text-xs font-medium",children:[e.jsx("span",{className:d(s.status),children:s.status}),s.status==="Return Rejected"&&e.jsx("span",{children:` - ${s.returnReason}`})]}),e.jsxs("div",{className:"flex gap-3",children:[u&&e.jsx("button",{onClick:()=>h(s._id),className:"text-xs text-red-600 hover:text-red-800 hover:underline font-medium",children:"Cancel Item"}),x&&e.jsx("button",{onClick:()=>l(s._id),className:"text-xs text-blue-600 hover:text-blue-800 hover:underline font-medium",children:"Return Item"})]})]})]})]})};C.propTypes={item:i.shape({_id:i.string.isRequired,title:i.string.isRequired,slug:i.string.isRequired,imageUrl:i.string.isRequired,size:i.string.isRequired,quantity:i.number.isRequired,salePrice:i.number.isRequired,status:i.string.isRequired}).isRequired,onCancelItem:i.func,onReturnItem:i.func,canReturn:i.bool};await G();const ie=()=>{const{orderId:s}=E(),h=L(),[l,x]=f.useState(""),[p,u]=f.useState({isOpen:!1,onProceed:null}),[d,a]=f.useState({isOpen:!1,action:null,itemId:null}),{order:r,isLoading:O,isError:P,error:_,actions:y,state:c,helpers:I}=U(s),[b,N]=f.useState(0);f.useEffect(()=>{if(!r?.timeline?.placedAt)return;const n=new Date(r.timeline.placedAt).getTime()+300*1e3,o=()=>{const R=Date.now(),w=n-R;w<=0?N(0):N(Math.floor(w/1e3))};o();const g=setInterval(o,1e3);return()=>clearInterval(g)},[r]);const{mutate:z}=H();if(O)return e.jsx(W,{text:"Loading order details..."});if(P)return e.jsx(M,{error:_});if(!r)return e.jsx("div",{className:"p-8 text-center",children:"Order not found"});const S=()=>{new window.Razorpay({key:"rzp_test_Rj623VA7C1CH6L",order_id:r.payment.razorpayOrderId,name:"11jersey.com",handler:n=>{console.log("paymentResult",n),z({razorpayOrderId:n.razorpay_order_id,razorpayPaymentId:n.razorpay_payment_id,razorpaySignature:n.razorpay_signature},{onSuccess:o=>{v.success("Payment successful!"),h(`/order-confirmation/${o?.data?._id}`)},onError:()=>v.error("Payment verification failed")})}}).open()},j=(t,n=null)=>{if(x(""),t.startsWith("cancel")){let o=r.price.discountedPrice;if(t==="cancel_item"&&n){const g=r.items.find(R=>R._id===n);g&&(o-=g.salePrice*g.quantity)}else t==="cancel_order"&&(o=0);if(o>0&&o<500){u({isOpen:!0,onProceed:()=>{u({isOpen:!1,onProceed:null}),a({isOpen:!0,action:t,itemId:n})}});return}}a({isOpen:!0,action:t,itemId:n})},A=()=>{const{action:t,itemId:n}=d;if(t.startsWith("return")&&!l.trim()){v.error("Please provide a reason to proceed with return.");return}t==="cancel_order"?y.cancelOrder(l):t==="cancel_item"?y.cancelItem(n,l):t==="return_order"?y.returnOrder(l):t==="return_item"&&y.returnItem(n,l),a({isOpen:!1,action:null,itemId:null}),x("")},m=d.action?.startsWith("return"),q=m?d.action==="return_order"?"Return Entire Order?":"Return Item?":d.action==="cancel_order"?"Cancel Entire Order?":"Cancel Item?",k=m?"Please confirm you want to return this. Our courier partner will pick it up.":"Are you sure you want to cancel? This action cannot be undone.";return e.jsx("div",{className:" min-h-screen pb-20",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>h(-1),className:"p-2 hover:bg-gray-200 rounded-full text-gray-600 transition-colors",children:e.jsx(J,{size:20})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Order #",r.orderId||r._id.slice(-6).toUpperCase()]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Placed on"," ",new Date(r.timeline.placedAt).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(F,{order:r,className:"border-gray-300 text-gray-700"}),c.canCancelOrder&&e.jsx("button",{onClick:()=>j("cancel_order"),disabled:c.isCancelling,className:"px-4 py-2 bg-white border border-red-200 text-red-600 text-sm font-medium rounded-md hover:bg-red-50 transition disabled:opacity-50",children:"Cancel Order"}),c.canReturnOrder&&e.jsx("button",{onClick:()=>j("return_order"),disabled:c.isReturning,className:"px-4 py-2 bg-white border border-blue-200 text-blue-600 text-sm font-medium rounded-md hover:bg-blue-50 transition disabled:opacity-50",children:"Return Order"}),r?.orderStatus==="Initialized"&&e.jsx("button",{onClick:S,disabled:b===0,className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md transition disabled:opacity-50",children:b>0?`Retry Payment (${Math.floor(b/60)}:${String(b%60).padStart(2,"0")})`:"Retry Disabled"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(V,{timeline:r.timeline,status:r.orderStatus}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50/50",children:[e.jsxs("h2",{className:"font-semibold text-gray-900",children:["Items (",r.items.length,")"]}),e.jsxs("span",{className:`text-xs font-bold px-2 py-1 rounded-full ${r.payment.status==="Paid"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-800"}`,children:["Payment: ",r.payment.status]})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:r.items.map(t=>e.jsx(C,{item:t,onCancelItem:n=>j("cancel_item",n),onReturnItem:n=>j("return_item",n),canReturn:I.getItemStatus(t).isReturnable},t._id))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{address:r.shippingAddress}),e.jsx(Y,{price:r.price})]})]}),e.jsx(B,{isOpen:p.isOpen,onClose:()=>u({isOpen:!1,onProceed:null}),onProceed:p.onProceed}),e.jsx($,{isOpen:d.isOpen,onClose:()=>a({...d,isOpen:!1}),onConfirm:A,title:q,message:k,confirmButtonText:m?"Confirm Return":"Yes, Cancel",confirmButtonVariant:m?"primary":"danger",isLoading:c.isCancelling||c.isItemCancelling||c.isReturning||c.isItemReturning,children:e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Reason ",m?"(Required)":"(Optional)"]}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-black focus:border-black focus:outline-none",rows:3,placeholder:m?"Why are you returning this? (e.g. Size too small)":"Why are you cancelling?",value:l,onChange:t=>x(t.target.value)})]})})]})})};export{ie as default};
