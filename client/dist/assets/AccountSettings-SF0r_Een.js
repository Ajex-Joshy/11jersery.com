import{aa as D,ab as c,ac as W,ad as X,ae as M,af as z,r as h,j as e,X as I,ag as d,l as S,z as l,P as m,m as G,s as H,W as q}from"./index-B5Zfx6Dp.js";import{a as J,b as K,c as Q,d as Y,u as Z}from"./userHooks-Bn5Me-xO.js";import{P as ee}from"./pencil-uGHd4pQe.js";const se=D({firstName:c().trim().min(1,"First name is required"),lastName:c().trim().min(1,"Last name is required"),image:X(File).refine(t=>t.size<=2*1024*1024,"Image must be 2MB or less").refine(t=>["image/jpeg","image/png","image/webp"].includes(t.type),"Only .jpg, .png, or .webp").nullable().optional(),gender:W(["male","female","other"],{errorMap:()=>({message:"Please select a gender"})}).optional(),dob_day:c().optional(),dob_month:c().optional(),dob_year:c().optional()}),ae=D({currentPassword:c().min(1,"Current password is required"),newPassword:c().min(6,"New password must be at least 6 characters"),confirmNewPassword:c()}).refine(t=>t.newPassword===t.confirmNewPassword,{message:"New passwords do not match",path:["confirmNewPassword"]}),U=({isOpen:t,onClose:r,user:a})=>{const{mutate:w,isLoading:u}=J(),{mutate:f,isLoading:g}=K(),{mutate:i,isLoading:j}=Q(),{register:p,handleSubmit:x,formState:{errors:y},reset:O,watch:C,setError:k,clearErrors:b}=M({resolver:z(se)}),[F,L]=h.useState(!1),[R,E]=h.useState(!1),[P,v]=h.useState(!1),o=C("email",""),T=C("otp","");h.useEffect(()=>{a&&(O({firstName:a.firstName||"",lastName:a.lastName||"",email:a.email||"",otp:""}),L(!1),E(!1),v(!1),b("otp"))},[a,t,O,b]),h.useEffect(()=>{console.log(o,a.email),a&&(L(o!==a.email),o===a.email&&(E(!1),v(!1),b("otp")))},[o,a,b]);const $=()=>{if(!o||o===a.email){l.error("Please enter a new email to send OTP.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)){l.error("Please enter a valid email");return}f({newEmail:o},{onSuccess:()=>{l.success("OTP sent to new email."),E(!0),v(!1),b("otp")},onError:n=>{console.log(n),l.error(n?.response?.data?.error?.message||"Failed to send OTP.")}})},A=()=>{if(!T){k("otp",{type:"manual",message:"Please enter the OTP."});return}i({newEmail:o,otp:T},{onSuccess:()=>{l.success("Email verified."),v(!0),b("otp")},onError:s=>{k("otp",{type:"manual",message:s?.message||"Invalid OTP."})}})},B=s=>{const n={};if(!s.firstName?.trim()||s.firstName.trim().length<2){l.error("First name must be at least 2 characters.");return}if(!s.lastName?.trim()||s.lastName.trim().length<2){l.error("Last name must be at least 2 characters.");return}if(s.firstName.trim().length>25){l.error("First name cannot exceed 25 characters.");return}if(s.lastName.trim().length>25){l.error("Last name cannot exceed 25 characters.");return}if(s.firstName!==a.firstName&&(n.firstName=s.firstName,console.log(s.firstName,a.firstName,n)),s.lastName!==a.lastName&&(n.lastName=s.lastName),console.log("data",s),console.log(s.email,a.email),s.email&&s.email!==a.email){if(!P){l.error("Please verify your new email before saving.");return}if(!s.email?.trim()){l.error("Email is required.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)){l.error("Invalid email format.");return}n.email=s.email}console.log("changedFields",n),Object.keys(n).length>0?w(n,{onSuccess:()=>r()}):(l("No changes detected."),r())};return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",onClick:r,children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl p-6 md:p-8 w-full max-w-lg m-4",onClick:s=>s.stopPropagation(),children:e.jsxs("form",{onSubmit:x(B),className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Personal Details"}),e.jsx("button",{type:"button",onClick:r,className:"text-gray-400 hover:text-gray-600",children:e.jsx(I,{})})]}),e.jsx(d,{id:"firstName",label:"First Name",...p("firstName"),error:y.firstName?.message}),e.jsx(d,{id:"lastName",label:"Last Name",...p("lastName"),error:y.lastName?.message}),e.jsx(d,{id:"email",label:"Email",type:"email",...p("email"),error:y.email?.message}),F&&e.jsxs("div",{className:"space-y-2",children:[!R&&e.jsx("button",{type:"button",onClick:$,disabled:g,className:"w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition disabled:opacity-50",children:g?e.jsx(S,{className:"w-5 h-5 animate-spin mx-auto"}):"Send OTP"}),R&&e.jsxs(e.Fragment,{children:[e.jsx(d,{id:"otp",label:"Enter OTP",...p("otp"),error:y.otp?.message}),e.jsx("button",{type:"button",onClick:A,disabled:j||P,className:"w-full bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700 transition disabled:opacity-50",children:j?e.jsx(S,{className:"w-5 h-5 animate-spin mx-auto"}):P?"OTP Verified":"Verify OTP"})]})]}),e.jsx("button",{type:"submit",disabled:u||F&&!P,className:"w-full bg-black text-white py-3 rounded-lg font-semibold hover:bg-gray-800 transition disabled:opacity-50",children:u?e.jsx(S,{className:"w-5 h-5 animate-spin mx-auto"}):"Save Changes"})]})})}):null};U.propTypes={isOpen:m.bool.isRequired,onClose:m.func.isRequired,user:m.shape({firstName:m.string,lastName:m.string,email:m.string}).isRequired};const _=({isOpen:t,onClose:r,userEmail:a})=>{const{mutate:w,isLoading:u}=Y(),{register:f,handleSubmit:g,formState:{errors:i},reset:j}=M({resolver:z(ae)}),p=x=>{w({currentPassword:x.currentPassword,newPassword:x.newPassword},{onSuccess:()=>{j(),r()}})};return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",onClick:r,children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl p-6 md:p-8 w-full max-w-md m-4",onClick:x=>x.stopPropagation(),children:e.jsxs("form",{onSubmit:g(p),className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Login Details"}),e.jsx("button",{type:"button",onClick:r,className:"text-gray-400 hover:text-gray-600",children:e.jsx(I,{})})]}),e.jsx(d,{id:"email",label:"Email",type:"email",value:a||"",disabled:!0,className:"bg-gray-100"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 pt-2 border-t",children:"Change Password"}),e.jsx(d,{id:"currentPassword",label:"Current Password",type:"password",...f("currentPassword"),error:i.currentPassword?.message}),e.jsx(d,{id:"newPassword",label:"New Password",type:"password",...f("newPassword"),error:i.newPassword?.message}),e.jsx(d,{id:"confirmNewPassword",label:"Confirm New Password",type:"password",...f("confirmNewPassword"),error:i.confirmNewPassword?.message}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-black text-white py-3 rounded-lg font-semibold hover:bg-gray-800 transition disabled:opacity-50",children:u?e.jsx(S,{className:"w-5 h-5 animate-spin mx-auto"}):"Save Changes"})]})})}):null};_.propTypes={isOpen:m.bool.isRequired,onClose:m.func.isRequired,userEmail:m.string};const V=({title:t,children:r,onEdit:a})=>e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:t}),e.jsx("button",{onClick:a,className:"p-2 rounded-full text-gray-500 hover:bg-gray-100 hover:text-black transition-colors","aria-label":`Edit ${t}`,children:e.jsx(ee,{size:16})})]}),e.jsx("div",{className:"space-y-3",children:r})]}),N=({label:t,value:r})=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 w-28 shrink-0",children:t}),e.jsx("span",{className:"text-md text-gray-800 wrap-break-words",children:r})]}),ne=()=>{const[t,r]=h.useState(null),{data:a,isLoading:w,isError:u,error:f}=Z(),g=G(H),i=a?.data||g;return w&&!i?e.jsx(LoadingSpinner,{text:"Loading Settings..."}):u?e.jsx(q,{error:f}):i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Account Settings"}),e.jsxs(V,{title:"Personal Details",onEdit:()=>r("personal"),children:[e.jsx(N,{label:"First Name",value:i.firstName||"..."}),e.jsx(N,{label:"Last Name",value:i.lastName||"..."}),e.jsx(N,{label:"Email",value:i.email||"..."})]}),e.jsxs(V,{title:"Phone & Password",onEdit:()=>r("password"),children:[e.jsx(N,{label:"Phone",value:i.phone}),e.jsx(N,{label:"Password",value:"••••••••"})]})]}),e.jsx(U,{isOpen:t==="personal",onClose:()=>r(null),user:i}),e.jsx(_,{isOpen:t==="password",onClose:()=>r(null),userEmail:i.email})]}):e.jsx(q,{error:{message:"User data could not be loaded."}})};export{ne as default};
