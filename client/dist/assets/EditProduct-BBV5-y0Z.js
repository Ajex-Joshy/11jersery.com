import{o as X,O as B,r as h,ae as J,af as Q,aM as F,j as e,ag as p,aN as f,aL as u,h as Z,Z as H,aV as G,z as N}from"./index-199rnzlN.js";import{p as K,P as W,S as Y,C as ee}from"./ProductImageDropzone-BPqTsEh-.js";import{e as se,a as te,f as ae}from"./productHooks-BMCeuHdQ.js";import"./ImageCropperModal-C4EWuTtp.js";import"./categoryHooks-CqBOlkk9.js";const re=["XS","S","M","L","XL","XXL"],de=()=>{const{slug:M}=X(),y=B(),{data:m,isLoading:q,isError:P,error:I}=se(M),{data:x}=te(),{mutate:E,isLoading:k}=ae(),o=h.useMemo(()=>m?.data?.product,[m]),S=h.useMemo(()=>m?.data?.faqs||[],[m]),[v,w]=h.useState([]),{register:n,handleSubmit:$,control:g,reset:T,formState:{errors:a,dirtyFields:j}}=J({resolver:Q(K),defaultValues:{}}),{fields:O}=F({control:g,name:"variants"}),{fields:A,replace:D,append:U,remove:z}=F({control:g,name:"faqs"});h.useEffect(()=>{if(o&&x?.data?.categories){const s=(o.variants||[]).reduce((r,l)=>(r[l.size]={size:l.size,stock:l.stock},r),{}),t=re.map(r=>s[r]||{size:r,stock:0}),b=x.data.categories||[],d=o.categoryIds?.map(r=>{const l=b.find(R=>R._id===r);return l?{value:l._id,label:l.title}:null}).filter(Boolean)||[],i=o.tags?.map(r=>({value:r,label:r}))||[],c=(o.details||[]).reduce((r,l)=>(r[l.attribute]=l.description,r),{});T({title:o.title,description:o.description||"",shortDescription:o.shortDescription||"",priceList:o.price?.list/100,priceSale:o.price?.sale/100||"",variants:t,categoryIds:d,tags:i,isListed:o.isListed?"true":"false",detailsMaterial:c.Material||"",detailsFitType:c["Fit Type"]||"",detailsNeckType:c["Neck Type"]||"",detailsSleeveType:c["Sleeve Type"]||"",detailsInstructions:c.Instructions||"",images:[],coverImageIndex:0},{keepDirty:!1,keepDefaultValues:!1}),D(S),w([])}},[o,S,x,T,D]);const _=s=>{const t=s.replace(`${G}/`,"");w(b=>[...b,t])},C=m?.data?.product?.imageUrls.filter(s=>s)||[];console.log("filteredInitialUrls",C,"urls",m?.data?.product?.imageUrls);const V=s=>{if(!o)return;const t=s.images||[];if(!(Object.keys(j).length>0||t.length>0||v.length>0)){N("No changes detected."),y("/admin/products");return}const d=new FormData,i={};Object.keys(j).forEach(r=>{switch(r){case"title":i.title=s.title;break;case"description":i.description=s.description;break;case"shortDescription":i.shortDescription=s.shortDescription;break;case"isListed":i.isListed=s.isListed;break;case"priceList":case"priceSale":i.price||(i.price={}),i.price.list=s.priceList,i.price.sale=s.priceSale||null;break;case"variants":i.variants=s.variants.filter(l=>l.stock>=0);break;case"categoryIds":i.categoryIds=s.categoryIds;break;case"tags":i.tags=s.tags;break;case"detailsMaterial":case"detailsFitType":case"detailsNeckType":case"detailsSleeveType":case"detailsInstructions":i.details||(i.details=[{attribute:"Material",description:s.detailsMaterial},{attribute:"Fit Type",description:s.detailsFitType},{attribute:"Neck Type",description:s.detailsNeckType},{attribute:"Sleeve Type",description:s.detailsSleeveType},{attribute:"Instructions",description:s.detailsInstructions}].filter(l=>l.description?.trim()));break;case"coverImageIndex":i.coverImageIndex=s.coverImageIndex;break}});let c=!1;if(Object.keys(i).length>0&&(d.append("productData",JSON.stringify(i)),c=!0),j.faqs&&(d.append("faqsData",JSON.stringify(s.faqs||[])),c=!0),t.length>0&&(t.forEach(r=>d.append("images",r)),c=!0,Object.prototype.hasOwnProperty.call(i,"coverImageIndex")||d.append("coverImageIndex",s.coverImageIndex.toString())),v.length>0&&(d.append("imagesToDelete",JSON.stringify(v)),c=!0),!c){N("No effective changes detected to save."),y("/admin/products");return}let L=m.data.product._id;E({id:L,formData:d},{onError:r=>{console.error("Error updating product:",r);const l=r?.response?.data?.error.message;N.error(l)}})};return q?e.jsx("div",{className:"p-6 text-center",children:"Loading product details..."}):P?e.jsxs("div",{className:"p-6 text-center text-red-500",children:["Error: ",I?.response?.data?.message||I.message]}):o?e.jsxs("div",{className:"p-6 bg-gray-50/50 min-h-screen",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Edit Product"}),e.jsxs("form",{onSubmit:$(V),className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6 bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h2",{className:"text-lg font-semibold border-b pb-2",children:"Basic Details"}),e.jsx(p,{label:"Product Title",id:"title",...n("title"),error:a.title?.message}),e.jsx(f,{label:"Product Description",id:"description",...n("description"),error:a.description?.message,rows:4}),e.jsx("h2",{className:"text-lg font-semibold border-b pb-2 pt-4",children:"Pricing"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Product list price (₹)",id:"priceList",type:"number",step:"0.01",...n("priceList"),error:a.priceList?.message}),e.jsx(p,{label:"Product sale price (₹)",id:"priceSale",type:"number",step:"0.01",...n("priceSale"),error:a.priceSale?.message})]})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-6 bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx(u,{name:"images",control:g,render:({field:s})=>e.jsx(u,{name:"coverImageIndex",control:g,render:({field:t})=>e.jsx(W,{label:"Product Images",onChangeFiles:s.onChange,valueFiles:s.value||[],onChangeCoverIndex:t.onChange,valueCoverIndex:t.value,initialImageUrls:C,onRemoveInitialImage:_,error:a.images?.message||a.images?.root?.message,aspect:1/1})})}),a.coverImageIndex&&e.jsx("span",{className:"text-red-500 text-sm mt-1 block",children:a.coverImageIndex.message}),e.jsx(f,{label:"Short Description",id:"shortDescription",...n("shortDescription"),error:a.shortDescription?.message,rows:3})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h2",{className:"text-lg font-semibold border-b pb-2 mb-6",children:"Inventory"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4",children:O.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between gap-4 p-3 bg-gray-50 rounded-md border border-gray-200",children:[e.jsx("label",{htmlFor:`variants.${t}.stock`,className:"w-10 text-center font-bold text-gray-800 uppercase flex-shrink-0",children:s.size}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:`variants.${t}.stock`,type:"number",min:"0",placeholder:"Stock",className:`border p-2 rounded-md w-24 text-center ${a.variants?.[t]?.stock?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:border-green-500 focus:ring-1 focus:ring-green-500"}`,...n(`variants.${t}.stock`)}),a.variants?.[t]?.stock&&e.jsx("p",{className:"text-red-500 text-xs mt-1 text-left",children:a.variants[t].stock.message})]})]},s.id))}),a.variants&&typeof a.variants.message=="string"&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:a.variants.message})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold border-b pb-2",children:"Categories"}),e.jsx(u,{name:"categoryIds",control:g,render:({field:s})=>e.jsx(Y,{...s,isMulti:!0,options:x?.data?.categories.map(t=>({value:t._id,label:t.title}))||[],className:"basic-multi-select",classNamePrefix:"select",placeholder:"Select categories..."})}),a.categoryIds&&e.jsx("span",{className:"text-red-500 text-sm",children:a.categoryIds.message}),e.jsx("h2",{className:"text-lg font-semibold border-b pb-2 pt-4",children:"Product Tags"}),e.jsx(u,{name:"tags",control:g,render:({field:s})=>e.jsx(ee,{...s,isMulti:!0,placeholder:"Type and press enter to add tags..."})}),a.tags&&e.jsx("span",{className:"text-red-500 text-sm",children:a.tags.message})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold border-b pb-2",children:"Product Details"}),e.jsx(p,{label:"Material",id:"detailsMaterial",...n("detailsMaterial"),error:a.detailsMaterial?.message}),e.jsx(p,{label:"Fit type",id:"detailsFitType",...n("detailsFitType"),error:a.detailsFitType?.message}),e.jsx(p,{label:"Neck type",id:"detailsNeckType",...n("detailsNeckType"),error:a.detailsNeckType?.message}),e.jsx(p,{label:"Sleeve type",id:"detailsSleeveType",...n("detailsSleeveType"),error:a.detailsSleeveType?.message}),e.jsx(f,{label:"Instructions",id:"detailsInstructions",...n("detailsInstructions"),error:a.detailsInstructions?.message,rows:3})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"FAQs"}),e.jsxs("button",{type:"button",onClick:()=>U({question:"",answer:""}),className:"text-sm text-green-600 hover:text-green-800 font-medium flex items-center gap-1",children:[e.jsx(Z,{size:16})," Add FAQ"]})]}),A.map((s,t)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 border-b pb-4 last:border-b-0",children:[e.jsx("div",{className:"md:col-span-5",children:e.jsx(p,{label:`Question ${t+1}`,id:`faqs.${t}.question`,...n(`faqs.${t}.question`),error:a.faqs?.[t]?.question?.message})}),e.jsx("div",{className:"md:col-span-6",children:e.jsx(f,{label:`Answer ${t+1}`,id:`faqs.${t}.answer`,...n(`faqs.${t}.answer`),error:a.faqs?.[t]?.answer?.message,rows:2})}),e.jsx("div",{className:"md:col-span-1 flex items-end justify-center pb-2",children:e.jsx("button",{type:"button",onClick:()=>z(t),className:"text-red-500 hover:text-red-700",children:e.jsx(H,{size:18})})})]},s.id))]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsx(u,{name:"isListed",control:g,render:({field:s})=>e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[" ",e.jsx("input",{type:"radio",onChange:()=>s.onChange("true"),checked:s.value==="true",className:"form-radio text-green-600 focus:ring-green-500"})," ",e.jsx("span",{className:"text-gray-700",children:"Listed"})," "]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[" ",e.jsx("input",{type:"radio",onChange:()=>s.onChange("false"),checked:s.value==="false",className:"form-radio text-gray-600 focus:ring-gray-500"})," ",e.jsx("span",{className:"text-gray-700",children:"Unlisted"})," "]})]})}),a.isListed&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:a.isListed.message})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>y("/admin/products"),className:"bg-gray-200 text-gray-800 py-2 px-6 rounded-lg font-medium hover:bg-gray-300 transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:k,className:"bg-black text-white py-2 px-8 rounded-lg font-medium hover:bg-gray-800 transition disabled:opacity-50 disabled:cursor-not-allowed",children:k?"Saving...":"Save Changes"})]})]})]},o._id)]}):e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Product data not found or still loading."})};export{de as default};
