import{O,r as h,z as a,a2 as P,g as w,a3 as S,j as e,P as c,a4 as R,d as _,a1 as C,W as M,L as v,p as N,a5 as E,a6 as I}from"./index-199rnzlN.js";import{u as A,a as L,b as $,c as T}from"./orderHooks-D11cPFwN.js";import{l as q}from"./loadRazorpay-CDvUoVkj.js";import{O as D}from"./OrderSummary-GxOrDlBV.js";import{S as W}from"./shield-check-Z23C9VkS.js";import{L as V}from"./lock-DdLkE2Uh.js";import"./arrow-right-BrA6Hsf4.js";await q();const Y=()=>{const n=O(),[m,r]=h.useState(!1),{mutate:l}=A(),{mutate:i}=L(),{mutate:d}=$(),{mutate:x}=T();return{processOrder:(p,t,y)=>{if(console.log("total",y),!p){a.error("Please select a payment method");return}if(r(!0),p==="cod")return y>P?(a.error(`Cannot process COD for order above ${w(P)}`),r(!1),null):l({shippingAddressId:t},{onSuccess:s=>{r(!1),a.success("Order placed successfully!"),n(`/order-confirmation/${s?.data?._id}`)},onError:s=>{r(!1),a.error(s?.response?.data?.error?.message||"COD payment failed")}});if(p==="wallet")return i({shippingAddressId:t},{onSuccess:s=>{r(!1),a.success("Wallet payment successful!"),n(`/order-confirmation/${s?.data?._id}`)},onError:s=>{r(!1),a.error(s?.response?.data?.error?.message||"Wallet payment failed")}});if(p==="online")return d({shippingAddressId:t},{onSuccess:s=>{const{amount:g,currency:o,razorpayOrderId:f}=s.data;console.log(g,o,f);const j=new window.Razorpay({key:S.VITE_RAZORPAY_KEY_ID,amount:g,currency:o,order_id:f,name:"11jersey.com",modal:{ondismiss:()=>{r(!1),a.error("Payment cancelled"),n("/account/orders")}},handler:u=>{console.log("paymentResult",u),x({razorpayOrderId:u.razorpay_order_id,razorpayPaymentId:u.razorpay_payment_id,razorpaySignature:u.razorpay_signature,shippingAddressId:t},{onSuccess:k=>{a.success("Payment successful!"),n(`/order-confirmation/${k?.data?._id}`)},onError:()=>a.error("Payment verification failed")})}});j.on("payment.failed",function(u){r(!1),a.error(u.error.description||"Payment failed, please try again")}),j.open(),r(!1)},onError:s=>{console.log(s),r(!1),a.error("Unable to initiate Razorpay payment")}})},isProcessing:m}},z=({id:n,title:m,description:r,icon:l,selected:i,onSelect:d})=>e.jsxs("div",{onClick:()=>d(n),className:`
        relative p-5 rounded-xl border-2 cursor-pointer transition-all duration-200 flex items-center gap-4
        ${i?"border-black bg-gray-50 ring-1 ring-black":"border-gray-200 hover:border-gray-300 bg-white"}
      `,children:[e.jsx("div",{className:`p-3 rounded-full ${i?"bg-black text-white":"bg-gray-100 text-gray-500"}`,children:e.jsx(l,{size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-bold ${i?"text-black":"text-gray-900"}`,children:m}),e.jsx("p",{className:"text-sm text-gray-500",children:r})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${i?"border-black":"border-gray-300"}`,children:i&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-black"})})]});z.propTypes={id:c.oneOfType([c.string,c.number]).isRequired,title:c.string.isRequired,description:c.string.isRequired,icon:c.elementType.isRequired,selected:c.bool.isRequired,onSelect:c.func.isRequired};const H=()=>{const n=O(),m=R(),{processOrder:r,isProcessing:l}=Y(),i=m.state?.selectedAddressId,{data:d,isLoading:x,isError:b,error:p}=_(),[t,y]=h.useState("wallet");if(h.useEffect(()=>{(d?.data?.items||[]).length===0&&n("/cart")},[d,n]),x)return e.jsx(C,{text:"Loading payment options..."});if(b)return e.jsx(M,{error:p});const s=async()=>{if(!t){a.error("Please select a payment method");return}r(t,i,d.data.total)},g=()=>l?"Processing...":t==="cod"||t==="wallet"?"Place Order":"Pay with Razorpay";return e.jsx("div",{className:"bg-gray-50 min-h-screen pb-20",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("nav",{className:"mb-8 text-sm flex items-center gap-2 text-gray-500",children:[e.jsx(v,{to:"/cart",className:"hover:text-black transition",children:"Cart"}),e.jsx(N,{size:14}),e.jsx(v,{to:"/checkout",className:"hover:text-black transition",children:"Checkout"}),e.jsx(N,{size:14}),e.jsx("span",{className:"font-medium text-black",children:"Payment"})]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Select Payment Method"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-7 space-y-6",children:[E.map(o=>{const f=I[o.icon];return e.jsx(z,{id:o.id,title:o.title,description:o.description,icon:f,selected:t===o.id,onSelect:y},o.id)}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg flex gap-3 text-sm text-blue-800 mt-6",children:[e.jsx(W,{className:"shrink-0",size:20}),e.jsx("p",{children:"Your payment information is encrypted and secure. We do not store your card details."})]})]}),e.jsx("div",{className:"lg:col-span-5",children:e.jsxs("div",{className:"sticky top-24 space-y-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:e.jsx(D,{isCheckoutPage:!0})}),e.jsxs("button",{onClick:s,disabled:l,className:"w-full bg-black text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-800 transition shadow-lg disabled:opacity-70 flex items-center justify-center gap-2",children:[g(),!l&&e.jsx(V,{size:18})]})]})})]})]})})};export{H as default};
