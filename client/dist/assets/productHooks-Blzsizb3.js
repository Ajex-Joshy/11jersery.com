import{S as C,v as g,w as q,x as P,Q,i as D,y as L,A as T,r as p,B as x,D as F,E as M,F as k,G as v,I as S,J as B,K as I,a as O,u as K}from"./index-B5Zfx6Dp.js";function w(e,s){const r=new Set(s);return e.filter(t=>!r.has(t))}function _(e,s,r){const t=e.slice(0);return t[s]=r,t}var A=class extends C{#r;#e;#n;#i;#s;#t;#o;#u;#a=[];constructor(e,s,r){super(),this.#r=e,this.#i=r,this.#n=[],this.#s=[],this.#e=[],this.setQueries(s)}onSubscribe(){this.listeners.size===1&&this.#s.forEach(e=>{e.subscribe(s=>{this.#d(e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#s.forEach(e=>{e.destroy()})}setQueries(e,s){this.#n=e,this.#i=s,g.batch(()=>{const r=this.#s,t=this.#l(this.#n);this.#a=t,t.forEach(o=>o.observer.setOptions(o.defaultedQueryOptions));const n=t.map(o=>o.observer),u=n.map(o=>o.getCurrentResult()),i=r.length!==n.length,h=n.some((o,d)=>o!==r[d]),l=i||h,y=l?!0:u.some((o,d)=>{const b=this.#e[d];return!b||!q(o,b)});!l&&!y||(l&&(this.#s=n),this.#e=u,this.hasListeners()&&(l&&(w(r,n).forEach(o=>{o.destroy()}),w(n,r).forEach(o=>{o.subscribe(d=>{this.#d(o,d)})})),this.#f()))})}getCurrentResult(){return this.#e}getQueries(){return this.#s.map(e=>e.getCurrentQuery())}getObservers(){return this.#s}getOptimisticResult(e,s){const r=this.#l(e),t=r.map(n=>n.observer.getOptimisticResult(n.defaultedQueryOptions));return[t,n=>this.#h(n??t,s),()=>this.#c(t,r)]}#c(e,s){return s.map((r,t)=>{const n=e[t];return r.defaultedQueryOptions.notifyOnChangeProps?n:r.observer.trackResult(n,u=>{s.forEach(i=>{i.observer.trackProp(u)})})})}#h(e,s){return s?((!this.#t||this.#e!==this.#u||s!==this.#o)&&(this.#o=s,this.#u=this.#e,this.#t=P(this.#t,s(e))),this.#t):e}#l(e){const s=new Map(this.#s.map(t=>[t.options.queryHash,t])),r=[];return e.forEach(t=>{const n=this.#r.defaultQueryOptions(t),u=s.get(n.queryHash);u?r.push({defaultedQueryOptions:n,observer:u}):r.push({defaultedQueryOptions:n,observer:new Q(this.#r,n)})}),r}#d(e,s){const r=this.#s.indexOf(e);r!==-1&&(this.#e=_(this.#e,r,s),this.#f())}#f(){if(this.hasListeners()){const e=this.#t,s=this.#c(this.#e,this.#a),r=this.#h(s,this.#i?.combine);e!==r&&g.batch(()=>{this.listeners.forEach(t=>{t(this.#e)})})}}};function U({queries:e,...s},r){const t=D(),n=L(),u=T(),i=p.useMemo(()=>e.map(a=>{const f=t.defaultQueryOptions(a);return f._optimisticResults=n?"isRestoring":"optimistic",f}),[e,t,n]);i.forEach(a=>{x(a),F(a,u)}),M(u);const[h]=p.useState(()=>new A(t,i,s)),[l,y,o]=h.getOptimisticResult(i,s.combine),d=!n&&s.subscribed!==!1;p.useSyncExternalStore(p.useCallback(a=>d?h.subscribe(g.batchCalls(a)):k,[h,d]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),p.useEffect(()=>{h.setQueries(i,s)},[i,s,h]);const R=l.some((a,f)=>v(i[f],a))?l.flatMap((a,f)=>{const c=i[f];if(c){const m=new Q(t,c);if(v(c,a))return S(c,m,u);B(a,n)&&S(c,m,u)}return[]}):[];if(R.length>0)throw Promise.all(R);const E=l.find((a,f)=>{const c=i[f];return c&&I({result:a,errorResetBoundary:u,throwOnError:c.throwOnError,query:t.getQueryCache().get(c.queryHash),suspense:c.suspense})});if(E?.error)throw E.error;return y(o())}const H=async e=>{const{data:s}=await O.get(`/product/${e}`);return s},Y=async e=>{const{data:s}=await O.get(`/product/faqs/${e}`);return s},j=async e=>{const{data:s}=await O.get("/products",{params:e});return s},z="productDetails",G="productFaqs",$="productsListing",N=e=>{const s=U({queries:[{queryKey:[z,e],queryFn:()=>H(e),enabled:!!e,staleTime:3e5},{queryKey:[G,e],queryFn:()=>Y(e),enabled:!!e,staleTime:36e5}]}),r=s.some(i=>i.isLoading),t=s.some(i=>i.isError),n=s.find(i=>i.isError)?.error;return{data:{detailsData:s[0].data?.data,faqsData:s[1].data?.data},isLoading:r,isError:t,error:n}},W=e=>{const s=typeof e.entries=="function"?Object.fromEntries(e.entries()):{...e};return K({queryKey:[$,s],queryFn:()=>j(e),keepPreviousData:!0,staleTime:1e3*60*5})};export{W as a,N as u};
