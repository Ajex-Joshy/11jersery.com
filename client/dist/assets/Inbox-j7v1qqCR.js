import{O as I,av as O,b0 as z,aZ as q,a_ as w,a$ as L,r as p,j as e,aw as P,C as E}from"./index-B5Zfx6Dp.js";import"./StatusBadge-ThsDvtkB.js";import{C as m}from"./circle-check-big-DH180LVK.js";import{C as x}from"./circle-x-DcyuO4gP.js";import{P as D}from"./package-check-DtODxttE.js";import{E as M}from"./eye-BbA0O436.js";const Z=()=>{const g=I(),{queryParams:h,uiState:c,handlers:n}=O({defaultSortBy:"updatedAt"}),{data:l,isLoading:f,isError:T,error:j}=z(h),R=l?.data?.requests||[],b=l?.payload?.pagination,{mutate:v,isLoading:y}=q(),{mutate:C,isLoading:N}=w(),{mutate:k,isLoading:S}=L(),[a,i]=p.useState({isOpen:!1,type:null,orderId:null,itemId:null}),[d,u]=p.useState(""),o=(t,r,s=null)=>{i({isOpen:!0,type:t,orderId:r,itemId:s}),u("")},_=()=>{const{type:t,orderId:r,itemId:s}=a;t==="approve"?v({orderId:r,itemId:s},{onSuccess:()=>i({...a,isOpen:!1})}):t==="reject"?C({orderId:r,itemId:s,reason:d},{onSuccess:()=>i({...a,isOpen:!1})}):t==="confirm_receipt"&&k({orderId:r,itemId:s},{onSuccess:()=>i({...a,isOpen:!1})})},A=[{header:"Order ID",key:"orderId",render:t=>e.jsxs("div",{children:[e.jsxs("span",{className:"font-mono font-medium",children:["#",t.orderId]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.userId?.firstName," ",t.userId?.lastName]})]})},{header:"Return Items",key:"items",render:t=>{const r=t.items.filter(s=>["Return Requested"].includes(s.status));return r.length===t.items.length&&t.orderStatus==="Return Requested"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500 flex-1",children:r.map(s=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.title}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Size: ",s.size]}),s.returnReason&&e.jsxs("span",{className:"text-xs text-orange-600 italic",children:["Reason: ",s.returnReason]})]},s._id))}),e.jsx("button",{onClick:()=>o("approve",t._id),title:"Approve Entire Order",className:"text-green-600 hover:bg-green-50 p-1 rounded",children:e.jsx(m,{size:16})}),e.jsx("button",{onClick:()=>o("reject",t._id),title:"Reject Entire Order",className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(x,{size:16})})]}):e.jsx("div",{className:"space-y-2",children:r.map(s=>e.jsxs("div",{className:"flex items-center justify-between gap-4 text-sm border-b border-gray-100 pb-1 last:border-0",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.title}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Size: ",s.size]}),s.returnReason&&e.jsxs("span",{className:"text-xs text-orange-600 italic",children:["Reason: ",s.returnReason]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="Return Requested"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>o("approve",t._id,s._id),title:"Approve",className:"text-green-600 hover:bg-green-50 p-1 rounded",children:e.jsx(m,{size:16})}),e.jsx("button",{onClick:()=>o("reject",t._id,s._id),title:"Reject",className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(x,{size:16})})]}),s.status==="Return Approved"&&e.jsxs("button",{onClick:()=>o("confirm_receipt",t._id,s._id),title:"Confirm Receipt",className:"text-blue-600 hover:bg-blue-50 p-1 rounded flex gap-1 items-center text-xs bg-blue-50 px-2",children:[e.jsx(D,{size:14})," Confirm Rec."]})]})]},s._id))})}},{header:"Date",key:"updatedAt",render:t=>new Date(t.updatedAt).toLocaleDateString("en-IN")},{header:"View",key:"action",render:t=>e.jsx("button",{onClick:()=>g(`/admin/orders/${t._id}`),className:"p-2 text-gray-500 hover:bg-gray-100 rounded-lg",children:e.jsx(M,{size:18})})}];return e.jsxs("div",{className:"p-6 bg-gray-50/50 min-h-screen",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Return Requests"}),e.jsx(P,{title:"Returns",columns:A,data:R,pagination:b,isLoading:f,error:j,searchValue:c.searchTerm,status:c.status,limit:c.limit,sortConfig:c.sortConfig,onSearchChange:n.onSearchChange,onStatusChange:n.onStatusChange,onLimitChange:n.onLimitChange,onSort:n.onSort,onPageChange:n.onPageChange}),e.jsx(E,{isOpen:a.isOpen,onClose:()=>i({...a,isOpen:!1}),onConfirm:_,title:a.type==="approve"?"Approve Return?":a.type==="reject"?"Reject Return?":"Confirm Receipt & Refund?",message:a.type==="approve"?"The user will be notified to ship the item back.":a.type==="reject"?"Please provide a reason for rejection.":"Confirming receipt will automatically restock the item and initiate a refund to the user's wallet/source.",confirmButtonText:a.type==="approve"?"Approve":a.type==="reject"?"Reject Request":"Confirm & Refund",confirmButtonVariant:a.type==="reject"?"danger":"success",isLoading:y||N||S,children:a.type==="reject"&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejection Reason"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-black focus:border-black",rows:3,value:d,onChange:t=>u(t.target.value),placeholder:"Why is this return being rejected?"})]})})]})};export{Z as default};
