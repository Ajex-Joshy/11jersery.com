import{o as w,O as D,ae as S,af as H,r as A,j as e,aL as P,ag as l,z as f}from"./index-B5Zfx6Dp.js";import{c as F,I}from"./ImageDropzone-UrB41zf4.js";import{d as O,e as U}from"./categoryHooks-CrOPncqd.js";import"./ImageCropperModal-CFWM9OCQ.js";const $=()=>{const{slug:T}=w(),b=D(),{data:c,isLoading:z,isError:M}=O(T),{mutate:C,isLoading:h}=U(),{register:a,handleSubmit:E,control:y,reset:j,setError:R,watch:N,setValue:o,unregister:d,formState:{errors:r}}=S({resolver:H(F),defaultValues:{title:"",offerEnabled:!1,discountType:"",discountAmount:void 0,minPurchaseAmount:void 0,discountPercentage:void 0,maxRedeemable:void 0,isListed:"true",inHome:!1,inCollections:!1,image:null}}),u=N("offerEnabled"),m=N("discountType");A.useEffect(()=>{if(c?.data){const s=c.data,t=!!(s.discount>0&&s.discountType);console.log("cat data",c.data),j({title:s.title,offerEnabled:t,discountType:t?s.discountType:"",discountAmount:s.discount,minPurchaseAmount:s.discountType==="flat"?s.minPurchaseAmount:void 0,discountPercentage:s.discountType==="percent"?s.discount:void 0,maxRedeemable:s.discountType==="percent"?s.maxRedeemable:void 0,isListed:s.isListed?"true":"false",inHome:s.inHome,inCollections:s.inCollections,image:null}),o("offerEnabled",t),o("discountType",s.discountType||"")}},[c,j,o]),A.useEffect(()=>{u?(a("discountType"),m==="flat"?(a("discountAmount"),a("minPurchaseAmount"),d(["discountPercentage","maxRedeemable"]),o("discountPercentage",void 0),o("maxRedeemable",void 0)):m==="percent"?(a("discountPercentage"),a("maxRedeemable"),d(["discountAmount","minPurchaseAmount"]),o("discountAmount",void 0),o("minPurchaseAmount",void 0)):d(["discountAmount","minPurchaseAmount","discountPercentage","maxRedeemable"])):(d(["discountType","discountAmount","minPurchaseAmount","discountPercentage","maxRedeemable"]),o("discountType",""),o("discountAmount",void 0),o("minPurchaseAmount",void 0),o("discountPercentage",void 0),o("maxRedeemable",void 0))},[u,m,a,d,o]),console.log(r);const L=s=>{const t=c?.data;if(!t){f.error("Original category data not loaded. Cannot update.");return}const n=new FormData;let i=!1;s.title!==t.title&&(n.append("title",s.title),i=!0);const p=t.discount>0&&t.discountType;(s.offerEnabled!==p||s.discountType!==t.discountType)&&(i=!0),s.offerEnabled&&s.discountType?(n.append("discountType",s.discountType),s.discountType==="flat"?(Number(s.discountAmount??0)!==Number(t.discount??0)&&(n.append("discount",s.discountAmount??0),i=!0),Number(s.minPurchaseAmount??0)!==Number(t.minPurchaseAmount??0)&&(n.append("minPurchaseAmount",s.minPurchaseAmount??0),i=!0),p&&t.discountType==="percent"&&(n.append("maxRedeemable",0),i=!0)):s.discountType==="percent"&&(Number(s.discountPercentage??0)!==Number(t.discount??0)&&(n.append("discount",s.discountPercentage??0),i=!0),Number(s.maxRedeemable??0)!==Number(t.maxRedeemable??0)&&(n.append("maxRedeemable",s.maxRedeemable??0),i=!0),p&&t.discountType==="flat"&&(n.append("minPurchaseAmount",0),i=!0))):p&&(n.append("discountType",""),n.append("discount",0),n.append("minPurchaseAmount",0),n.append("maxRedeemable",0),i=!0);const v=s.isListed===!0;if(v!==t.isListed&&(n.append("isListed",v),i=!0),s.inHome!==t.inHome&&(n.append("inHome",s.inHome),i=!0),s.inCollections!==t.inCollections&&(n.append("inCollections",s.inCollections),i=!0),s.image instanceof File&&(n.append("image",s.image),i=!0),!i){f("No changes detected."),b("/admin/categories");return}for(const[g,x]of n.entries())console.log("formData",g,x);const k=t._id;C({id:k,formData:n},{onError:g=>{const x=g.response?.data?.error;x?.code==="CATEGORY_ALREADY_EXISTS"?R("title",{type:"manual",message:x.message}):f.error(g.response?.data?.message||"Update failed.")}})};return e.jsxs("div",{className:"p-6 bg-gray-50/50 min-h-screen",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Edit Category"}),e.jsxs("form",{onSubmit:E(L),className:"bg-white p-8 rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:"Header Image"}),e.jsx(P,{name:"image",control:y,render:({field:s})=>e.jsx(I,{onChange:s.onChange,value:s.value,initialImageUrl:c?.data?.imageUrl,aspect:16/9})}),r.image&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:r.image.message})]}),e.jsx("div",{className:"mb-6 border-t pt-6",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",...a("offerEnabled"),className:"form-checkbox rounded text-green-600 h-5 w-5 focus:ring-green-500"}),e.jsx("span",{className:"text-md font-medium text-gray-700",children:"Enable Offer for this Category"})]})}),u&&e.jsxs("div",{className:"mb-6 pt-6 border-t animate-fadeIn",children:[e.jsxs("div",{className:"mb-6 max-w-xs",children:[e.jsx("label",{htmlFor:"discountType",className:"mb-1 block text-sm font-medium text-gray-700",children:"Discount Type"}),e.jsxs("select",{id:"discountType",className:`border p-2 rounded-md w-full ${r.discountType?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-green-500 focus:ring-green-500"} focus:outline-none focus:ring-1`,...a("discountType"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select discount type..."}),e.jsx("option",{value:"flat",children:"Flat Amount (₹)"}),e.jsx("option",{value:"percent",children:"Percentage (%)"})]}),r.discountType&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:r.discountType.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m==="flat"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{label:"Discount Amount (₹)",id:"discountAmount",type:"number",step:"0.01",...a("discountAmount"),error:r.discountAmount?.message}),e.jsx(l,{label:"Minimum Purchase Amount (₹)",id:"minPurchaseAmount",type:"number",step:"0.01",...a("minPurchaseAmount"),error:r.minPurchaseAmount?.message})]}),m==="percent"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{label:"Discount Percentage (%)",id:"discountPercentage",type:"number",min:"0",max:"100",step:"0.1",...a("discountPercentage"),error:r.discountPercentage?.message}),e.jsx(l,{label:"Max Redeemable Amount (₹)",id:"maxRedeemable",type:"number",step:"0.01",...a("maxRedeemable"),error:r.maxRedeemable?.message})]})]})]}),e.jsx("div",{className:`mb-6 ${u?"border-t pt-6":""}`,children:e.jsx(l,{label:"Category Name",id:"title",type:"text",...a("title"),error:r.title?.message})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-6 mb-8 border-t pt-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsx(P,{name:"isListed",control:y,render:({field:s})=>e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",onChange:()=>s.onChange("true"),checked:s.value==="true",className:"form-radio text-green-600 focus:ring-green-500"}),e.jsx("span",{className:"text-gray-700",children:"Listed"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",onChange:()=>s.onChange("false"),checked:s.value==="false",className:"form-radio text-gray-600 focus:ring-gray-500"}),e.jsx("span",{className:"text-gray-700",children:"Unlisted"})]})]})}),r.isListed&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:r.isListed.message})]}),e.jsxs("div",{className:"flex flex-col gap-4 pt-4 md:pt-0 md:items-start md:ml-auto",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",...a("inHome"),className:"form-checkbox rounded text-green-600 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Show in Homepage 'Discover' section"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",...a("inCollections"),className:"form-checkbox rounded text-green-600 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Show in 'Browse by Collections' section"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t pt-6",children:[e.jsx("button",{type:"button",onClick:()=>b("/admin/categories"),className:"bg-gray-200 text-gray-800 py-2 px-6 rounded-lg font-medium hover:bg-gray-300 transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:"bg-black text-white py-2 px-8 rounded-lg font-medium hover:bg-gray-800 transition disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Saving...":"Save Changes"})]})]})]})};export{$ as default};
